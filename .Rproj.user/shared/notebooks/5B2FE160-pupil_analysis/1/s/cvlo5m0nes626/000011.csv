"0","# transpose to wide format"
"0","df_wide <- df %>%"
"0","  dplyr::select(ptid, mtm, eye, trial_id, pupil_sm_pctChg, is_user, time_since_use, age_in_years, bmi) %>%"
"0","  filter(eye == ""Right"" & mtm == ""1_Post1"") %>%"
"0","  group_by(trial_id) %>%"
"0","  mutate(frame = row_number()) %>%"
"0","  ungroup() %>%"
"0","  pivot_wider(names_from = frame, values_from = pupil_sm_pctChg, names_prefix = ""pct_chg_"")"
"0",""
"0","# extract functional matrix X (N x P)"
"0","curve_cols <- paste0(""pct_chg_"", 1:119)"
"0","stopifnot(all(curve_cols %in% names(df_wide)))"
"0","X <- as.matrix(df_wide[, curve_cols])"
"0",""
"0","# define s_grid (length P)"
"0","# s_grid <- seq(0, 1, length.out = ncol(X))"
"0","s_grid <- sort(unique((df$time)))[-120]"
"0",""
"0","# survival outcome"
"0","time <- df_wide$time_since_use"
"0","status <- df_wide$is_user"
"0",""
"0","# cluster id"
"0","cluster_id <- df_wide$ptid"
"0",""
"0","# scalar covariates design matrix Z"
"0","# Columns are: (Intercept), age_in_years, bmi"
"0","Z <- model.matrix(~ age_in_years + bmi, data = df_wide)"
